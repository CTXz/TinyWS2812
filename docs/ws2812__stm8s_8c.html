<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Tiny-WS2812: src/ws2812_stm8s.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Tiny-WS2812
   &#160;<span id="projectnumber">1.0.0</span>
   </div>
   <div id="projectbrief">A tiny cross-platform WS2812 LED Strip driver</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">ws2812_stm8s.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Driver code for STM8S chips.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stm8s.h&gt;</code><br />
<code>#include &lt;stddef.h&gt;</code><br />
<code>#include &lt;stdbool.h&gt;</code><br />
<code>#include &lt;<a class="el" href="ws2812__common_8h_source.html">ws2812_common.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="ws2812__stm8s_8h_source.html">ws2812_stm8s.h</a>&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for ws2812_stm8s.c:</div>
<div class="dyncontent">
<div class="center"><img src="ws2812__stm8s_8c__incl.png" border="0" usemap="#asrc_2ws2812__stm8s_8c" alt=""/></div>
</div>
</div>
<p><a href="ws2812__stm8s_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a3431f68abb53bbdbbce0ff96b6ab50f0"><td class="memItemLeft" align="right" valign="top"><a id="a3431f68abb53bbdbbce0ff96b6ab50f0"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ws2812__stm8s_8c.html#a3431f68abb53bbdbbce0ff96b6ab50f0">TICKS_PER_LOOP</a>&#160;&#160;&#160;2</td></tr>
<tr class="memdesc:a3431f68abb53bbdbbce0ff96b6ab50f0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Number of CPU ticks per loop in delay_us function. <br /></td></tr>
<tr class="separator:a3431f68abb53bbdbbce0ff96b6ab50f0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9d886dba43e7948ff8303c4313551675"><td class="memItemLeft" align="right" valign="top"><a id="a9d886dba43e7948ff8303c4313551675"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ws2812__stm8s_8c.html#a9d886dba43e7948ff8303c4313551675">LOOPS_PER_US</a>&#160;&#160;&#160;(F_CPU / <a class="el" href="ws2812__stm8s_8c.html#a3431f68abb53bbdbbce0ff96b6ab50f0">TICKS_PER_LOOP</a> / 1000000UL)</td></tr>
<tr class="memdesc:a9d886dba43e7948ff8303c4313551675"><td class="mdescLeft">&#160;</td><td class="mdescRight">Number for loops required for 1 us to pass. <br /></td></tr>
<tr class="separator:a9d886dba43e7948ff8303c4313551675"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac7fa35614a6176e69b13876e3368d212"><td class="memItemLeft" align="right" valign="top"><a id="ac7fa35614a6176e69b13876e3368d212"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ws2812__stm8s_8c.html#ac7fa35614a6176e69b13876e3368d212">LDW_OVERHEAD</a>&#160;&#160;&#160;2</td></tr>
<tr class="memdesc:ac7fa35614a6176e69b13876e3368d212"><td class="mdescLeft">&#160;</td><td class="mdescRight">Number of CPU ticks for the LDW instruction. <br /></td></tr>
<tr class="separator:ac7fa35614a6176e69b13876e3368d212"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a7b9cc89b40c838856b1fc741d5ab9a94"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ws2812__stm8s_8c.html#a7b9cc89b40c838856b1fc741d5ab9a94">ws2812_config</a> (<a class="el" href="structws2812.html">ws2812</a> *dev, <a class="el" href="structws2812__cfg.html">ws2812_cfg</a> *cfg)</td></tr>
<tr class="memdesc:a7b9cc89b40c838856b1fc741d5ab9a94"><td class="mdescLeft">&#160;</td><td class="mdescRight">Configures a <a class="el" href="structws2812.html">WS2812 device struct</a>.  <a href="ws2812__stm8s_8c.html#a7b9cc89b40c838856b1fc741d5ab9a94">More...</a><br /></td></tr>
<tr class="separator:a7b9cc89b40c838856b1fc741d5ab9a94"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8ac53e8d64e1fc6073e85ea0fd80a975"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ws2812__stm8s_8c.html#a8ac53e8d64e1fc6073e85ea0fd80a975">ws2812_prep_tx</a> (<a class="el" href="structws2812.html">ws2812</a> *dev)</td></tr>
<tr class="memdesc:a8ac53e8d64e1fc6073e85ea0fd80a975"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prepares the host device for data transmission.  <a href="ws2812__stm8s_8c.html#a8ac53e8d64e1fc6073e85ea0fd80a975">More...</a><br /></td></tr>
<tr class="separator:a8ac53e8d64e1fc6073e85ea0fd80a975"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2eb0bca405f4e5cffbed88230fd35038"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ws2812__stm8s_8c.html#a2eb0bca405f4e5cffbed88230fd35038">ws2812_wait_rst</a> (<a class="el" href="structws2812.html">ws2812</a> *dev)</td></tr>
<tr class="memdesc:a2eb0bca405f4e5cffbed88230fd35038"><td class="mdescLeft">&#160;</td><td class="mdescRight">Waits for the <a class="el" href="structws2812.html">WS2812 device</a> to reset.  <a href="ws2812__stm8s_8c.html#a2eb0bca405f4e5cffbed88230fd35038">More...</a><br /></td></tr>
<tr class="separator:a2eb0bca405f4e5cffbed88230fd35038"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a910f8836ea93491a427642d1a6f631d4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ws2812__stm8s_8c.html#a910f8836ea93491a427642d1a6f631d4">ws2812_tx</a> (<a class="el" href="structws2812.html">ws2812</a> *dev, <a class="el" href="structws2812__rgb.html">ws2812_rgb</a> *<a class="el" href="arduino__avr_2blink__cpp_8cpp.html#a69b7b102ebcf421b7170ebe2926126e4">leds</a>, size_t n_leds)</td></tr>
<tr class="memdesc:a910f8836ea93491a427642d1a6f631d4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Transmits RGB values to the provided <a class="el" href="structws2812.html">WS2812 device</a>.  <a href="ws2812__stm8s_8c.html#a910f8836ea93491a427642d1a6f631d4">More...</a><br /></td></tr>
<tr class="separator:a910f8836ea93491a427642d1a6f631d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0c2ce6b9d36f5c768bfdd781812aea34"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ws2812__stm8s_8c.html#a0c2ce6b9d36f5c768bfdd781812aea34">ws2812_close_tx</a> (<a class="el" href="structws2812.html">ws2812</a> *dev)</td></tr>
<tr class="memdesc:a0c2ce6b9d36f5c768bfdd781812aea34"><td class="mdescLeft">&#160;</td><td class="mdescRight">Closes a WS2812 transmission.  <a href="ws2812__stm8s_8c.html#a0c2ce6b9d36f5c768bfdd781812aea34">More...</a><br /></td></tr>
<tr class="separator:a0c2ce6b9d36f5c768bfdd781812aea34"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Driver code for STM8S chips. </p>
<dl class="section author"><dt>Author</dt><dd>Patrick Pedersen </dd></dl>
<dl class="section date"><dt>Date</dt><dd>2022-10-26</dd></dl>
<p>The following file holds the Tiny-WS2812 library code to drive WS2812 devices on STM8S chips. </p>

<p class="definition">Definition in file <a class="el" href="ws2812__stm8s_8c_source.html">ws2812_stm8s.c</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a0c2ce6b9d36f5c768bfdd781812aea34"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0c2ce6b9d36f5c768bfdd781812aea34">&#9670;&nbsp;</a></span>ws2812_close_tx()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ws2812_close_tx </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structws2812.html">ws2812</a> *&#160;</td>
          <td class="paramname"><em>dev</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Closes a WS2812 transmission. </p>
<p>The following function should be called after ending data transmission with a WS2812 device. The exact closing procedure is platform specific but will typically involve restoring stashed registers to their previous states, re-enable interrupts, wait for the WS2812 to reset by calling <a class="el" href="ws2812_8h.html#a2eb0bca405f4e5cffbed88230fd35038" title="Waits for the WS2812 device to reset.">ws2812_wait_rst()</a>, and potentially alter fields of the provided <a class="el" href="structws2812.html">WS2812 device struct</a>. </p>

<p class="definition">Definition at line <a class="el" href="ws2812__stm8s_8c_source.html#l00263">263</a> of file <a class="el" href="ws2812__stm8s_8c_source.html">ws2812_stm8s.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;{</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="keywordflow">if</span> (_prep == <span class="keyword">false</span>)</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160; </div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    _prep = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        <a class="code" href="ws2812__stm8s_8c.html#a2eb0bca405f4e5cffbed88230fd35038">ws2812_wait_rst</a>(dev);</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;}</div>
<div class="ttc" id="aws2812__stm8s_8c_html_a2eb0bca405f4e5cffbed88230fd35038"><div class="ttname"><a href="ws2812__stm8s_8c.html#a2eb0bca405f4e5cffbed88230fd35038">ws2812_wait_rst</a></div><div class="ttdeci">void ws2812_wait_rst(ws2812 *dev)</div><div class="ttdoc">Waits for the WS2812 device to reset.</div><div class="ttdef"><b>Definition:</b> <a href="ws2812__stm8s_8c_source.html#l00119">ws2812_stm8s.c:119</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7b9cc89b40c838856b1fc741d5ab9a94"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7b9cc89b40c838856b1fc741d5ab9a94">&#9670;&nbsp;</a></span>ws2812_config()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t ws2812_config </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structws2812.html">ws2812</a> *&#160;</td>
          <td class="paramname"><em>dev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structws2812__cfg.html">ws2812_cfg</a> *&#160;</td>
          <td class="paramname"><em>cfg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Configures a <a class="el" href="structws2812.html">WS2812 device struct</a>. </p>
<p>The following function initializes/configures a <a class="el" href="structws2812.html">WS2812 device struct</a> using a <a class="el" href="structws2812__cfg.html">ws2812_cfg configuration struct</a>. </p>

<p class="definition">Definition at line <a class="el" href="ws2812__stm8s_8c_source.html#l00083">83</a> of file <a class="el" href="ws2812__stm8s_8c_source.html">ws2812_stm8s.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;{</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    dev-&gt;<a class="code" href="structws2812.html#a0b0333bd5d756fc972d0fe6f9796bcae">port_baseaddr</a> = cfg-&gt;<a class="code" href="structws2812__cfg.html#a920b28abe3e57ffafa244b56e6d1dcb0">port_baseaddr</a>;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    dev-&gt;<a class="code" href="structws2812.html#aac098f9c6f0f802c066122e0166d6970">rst_time_us</a> = cfg-&gt;<a class="code" href="structws2812__cfg.html#a9131a1de83995aa8c917e1a3c6ee1fa5">rst_time_us</a>;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160; </div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    GPIO_TypeDef *port = (GPIO_TypeDef *)dev-&gt;<a class="code" href="structws2812.html#a0b0333bd5d756fc972d0fe6f9796bcae">port_baseaddr</a>;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160; </div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    uint8_t pin_msk = 0;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160; </div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    for (uint8_t i = 0; i &lt; cfg-&gt;<a class="code" href="structws2812__cfg.html#a2a6404a5d1e6d8829e2abcf5d916715b">n_dev</a>; i++) {</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        pin_msk |= cfg-&gt;<a class="code" href="structws2812__cfg.html#ae4f693b8495942acae05da3df3bcfa58">pins</a>[i];</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        GPIO_Init(port, cfg-&gt;<a class="code" href="structws2812__cfg.html#ae4f693b8495942acae05da3df3bcfa58">pins</a>[i], GPIO_MODE_OUT_PP_LOW_FAST);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    }</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160; </div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    dev-&gt;<a class="code" href="structws2812.html#ae191c20dea8f9cca0bb92e9d0431f721">maskhi</a> = pin_msk;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    dev-&gt;<a class="code" href="structws2812.html#ad04d92a4b1276fbb588960ad009b67b9">masklo</a> = ~pin_msk;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160; </div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <a class="code" href="ws2812__common_8c.html#abb76184063c2d58324bde5457e32bee0">_ws2812_get_rgbmap</a>(&amp;dev-&gt;<a class="code" href="structws2812.html#aa2c696b52505f456607b73f9f200c2cf">rgbmap</a>, cfg-&gt;<a class="code" href="structws2812__cfg.html#ad50d0defcc33c93e648889222b93c1aa">order</a>);</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160; </div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;}</div>
<div class="ttc" id="astructws2812__cfg_html_a2a6404a5d1e6d8829e2abcf5d916715b"><div class="ttname"><a href="structws2812__cfg.html#a2a6404a5d1e6d8829e2abcf5d916715b">ws2812_cfg::n_dev</a></div><div class="ttdeci">uint8_t n_dev</div><div class="ttdoc">Number of WS2812 device to drive.</div><div class="ttdef"><b>Definition:</b> <a href="ws2812__avr_8h_source.html#l00078">ws2812_avr.h:78</a></div></div>
<div class="ttc" id="astructws2812__cfg_html_a9131a1de83995aa8c917e1a3c6ee1fa5"><div class="ttname"><a href="structws2812__cfg.html#a9131a1de83995aa8c917e1a3c6ee1fa5">ws2812_cfg::rst_time_us</a></div><div class="ttdeci">uint8_t rst_time_us</div><div class="ttdoc">Time required for the WS2812 device(s) to reset in us.</div><div class="ttdef"><b>Definition:</b> <a href="ws2812__avr_8h_source.html#l00076">ws2812_avr.h:76</a></div></div>
<div class="ttc" id="astructws2812__cfg_html_a920b28abe3e57ffafa244b56e6d1dcb0"><div class="ttname"><a href="structws2812__cfg.html#a920b28abe3e57ffafa244b56e6d1dcb0">ws2812_cfg::port_baseaddr</a></div><div class="ttdeci">uint16_t port_baseaddr</div><div class="ttdoc">Base address of the port used to drive WS2812 devices (ex. GPIOA_BASE, GPIOB_BASE,...</div><div class="ttdef"><b>Definition:</b> <a href="ws2812__stm8s_8h_source.html#l00069">ws2812_stm8s.h:69</a></div></div>
<div class="ttc" id="astructws2812__cfg_html_ad50d0defcc33c93e648889222b93c1aa"><div class="ttname"><a href="structws2812__cfg.html#ad50d0defcc33c93e648889222b93c1aa">ws2812_cfg::order</a></div><div class="ttdeci">ws2812_order order</div><div class="ttdoc">CoColor order of the WS2812 device(s) (ex. rgb, grb, bgr...)</div><div class="ttdef"><b>Definition:</b> <a href="ws2812__avr_8h_source.html#l00077">ws2812_avr.h:77</a></div></div>
<div class="ttc" id="astructws2812__cfg_html_ae4f693b8495942acae05da3df3bcfa58"><div class="ttname"><a href="structws2812__cfg.html#ae4f693b8495942acae05da3df3bcfa58">ws2812_cfg::pins</a></div><div class="ttdeci">uint8_t * pins</div><div class="ttdoc">Array of pins used to program WS2812 devices (Must share the same PORT! (ex. PB0, PB1,...</div><div class="ttdef"><b>Definition:</b> <a href="ws2812__avr_8h_source.html#l00069">ws2812_avr.h:69</a></div></div>
<div class="ttc" id="astructws2812_html_a0b0333bd5d756fc972d0fe6f9796bcae"><div class="ttname"><a href="structws2812.html#a0b0333bd5d756fc972d0fe6f9796bcae">ws2812::port_baseaddr</a></div><div class="ttdeci">uint16_t port_baseaddr</div><div class="ttdoc">Base address of the port used to drive WS2812 devices (ex. GPIOA_BASE, GPIOB_BASE,...</div><div class="ttdef"><b>Definition:</b> <a href="ws2812__stm8s_8h_source.html#l00102">ws2812_stm8s.h:102</a></div></div>
<div class="ttc" id="astructws2812_html_aa2c696b52505f456607b73f9f200c2cf"><div class="ttname"><a href="structws2812.html#aa2c696b52505f456607b73f9f200c2cf">ws2812::rgbmap</a></div><div class="ttdeci">uint8_t rgbmap[3]</div><div class="ttdoc">RGB map to map/convert RGB values to another color order.</div><div class="ttdef"><b>Definition:</b> <a href="ws2812__avr_8h_source.html#l00112">ws2812_avr.h:112</a></div></div>
<div class="ttc" id="astructws2812_html_aac098f9c6f0f802c066122e0166d6970"><div class="ttname"><a href="structws2812.html#aac098f9c6f0f802c066122e0166d6970">ws2812::rst_time_us</a></div><div class="ttdeci">uint8_t rst_time_us</div><div class="ttdoc">Time required for WS2812 to reset in us.</div><div class="ttdef"><b>Definition:</b> <a href="ws2812__avr_8h_source.html#l00109">ws2812_avr.h:109</a></div></div>
<div class="ttc" id="astructws2812_html_ad04d92a4b1276fbb588960ad009b67b9"><div class="ttname"><a href="structws2812.html#ad04d92a4b1276fbb588960ad009b67b9">ws2812::masklo</a></div><div class="ttdeci">uint8_t masklo</div><div class="ttdoc">PORT masks to toggle the data pins low.</div><div class="ttdef"><b>Definition:</b> <a href="ws2812__avr_8h_source.html#l00111">ws2812_avr.h:111</a></div></div>
<div class="ttc" id="astructws2812_html_ae191c20dea8f9cca0bb92e9d0431f721"><div class="ttname"><a href="structws2812.html#ae191c20dea8f9cca0bb92e9d0431f721">ws2812::maskhi</a></div><div class="ttdeci">uint8_t maskhi</div><div class="ttdoc">PORT masks to toggle the data pins high.</div><div class="ttdef"><b>Definition:</b> <a href="ws2812__avr_8h_source.html#l00110">ws2812_avr.h:110</a></div></div>
<div class="ttc" id="aws2812__common_8c_html_abb76184063c2d58324bde5457e32bee0"><div class="ttname"><a href="ws2812__common_8c.html#abb76184063c2d58324bde5457e32bee0">_ws2812_get_rgbmap</a></div><div class="ttdeci">void _ws2812_get_rgbmap(uint8_t(*rgbmap)[3], ws2812_order order)</div><div class="ttdoc">Initializes a rgb map for a given color order.</div><div class="ttdef"><b>Definition:</b> <a href="ws2812__common_8c_source.html#l00043">ws2812_common.c:43</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8ac53e8d64e1fc6073e85ea0fd80a975"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8ac53e8d64e1fc6073e85ea0fd80a975">&#9670;&nbsp;</a></span>ws2812_prep_tx()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ws2812_prep_tx </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structws2812.html">ws2812</a> *&#160;</td>
          <td class="paramname"><em>dev</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Prepares the host device for data transmission. </p>
<p>The following function prepares the host device for data transmission. The exact preperation procedure is platform specific, but typically will involve disabling interrupts, stashing registers that may be modified when communicating to the WS2812 device and potentially preparing the passed <a class="el" href="structws2812.html">WS2812 device struct</a> for data transmission. For a more detailed understanding, please refer to the platform specific code of this function.</p>
<dl class="section warning"><dt>Warning</dt><dd>Always call this function before making any calls to <a class="el" href="ws2812_8h.html#af2db6a7db2e9f0a57921b01037202e15" title="Transmits RGB values to the provided WS2812 device.">ws2812_tx()</a>! Not doing so may result in undefined behaivour! </dd></dl>

<p class="definition">Definition at line <a class="el" href="ws2812__stm8s_8c_source.html#l00106">106</a> of file <a class="el" href="ws2812__stm8s_8c_source.html">ws2812_stm8s.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;{</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="keywordflow">if</span> (_prep == <span class="keyword">true</span>)</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160; </div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    _port_odr_addr = dev-&gt;<a class="code" href="structws2812.html#a0b0333bd5d756fc972d0fe6f9796bcae">port_baseaddr</a>;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    _mask_hi = dev-&gt;<a class="code" href="structws2812.html#ae191c20dea8f9cca0bb92e9d0431f721">maskhi</a>;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    _mask_lo = dev-&gt;<a class="code" href="structws2812.html#ad04d92a4b1276fbb588960ad009b67b9">masklo</a>;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    </div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    _prep = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a910f8836ea93491a427642d1a6f631d4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a910f8836ea93491a427642d1a6f631d4">&#9670;&nbsp;</a></span>ws2812_tx()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ws2812_tx </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structws2812.html">ws2812</a> *&#160;</td>
          <td class="paramname"><em>dev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structws2812__rgb.html">ws2812_rgb</a> *&#160;</td>
          <td class="paramname"><em>pxls</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>n_pxls</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Transmits RGB values to the provided <a class="el" href="structws2812.html">WS2812 device</a>. </p>
<p>The following function transmits RGB values to the provided <a class="el" href="structws2812.html">WS2812 device</a>. Calling this function consecutively for the same device will continue programming LEDs after the position where the last transmission has ended. In other words, calling the function consecutively for the same device will <b>NOT</b> program the device from the first LED, but rather take off from where it last ended. If this is not desired, call <a class="el" href="ws2812_8h.html#a2eb0bca405f4e5cffbed88230fd35038" title="Waits for the WS2812 device to reset.">ws2812_wait_rst()</a> after each transmission. </p>

<p class="definition">Definition at line <a class="el" href="ws2812__stm8s_8c_source.html#l00252">252</a> of file <a class="el" href="ws2812__stm8s_8c_source.html">ws2812_stm8s.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;{</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; n_leds; i++) {</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                <span class="keywordflow">for</span> (uint8_t j = 0; j &lt; <span class="keyword">sizeof</span>(dev-&gt;<a class="code" href="structws2812.html#aa2c696b52505f456607b73f9f200c2cf">rgbmap</a>); j++) {</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                        uint8_t *pxl = (uint8_t *) &amp;(<a class="code" href="arduino__avr_2blink__array_8c.html#a69b7b102ebcf421b7170ebe2926126e4">leds</a>[i]);</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                        <a class="code" href="ws2812__avr_8c.html#ae286d1f394d345649b3ad08404fcfed5">ws2812_tx_byte</a>(pxl[dev-&gt;<a class="code" href="structws2812.html#aa2c696b52505f456607b73f9f200c2cf">rgbmap</a>[j]]);</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                }</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        }</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;}</div>
<div class="ttc" id="aarduino__avr_2blink__array_8c_html_a69b7b102ebcf421b7170ebe2926126e4"><div class="ttname"><a href="arduino__avr_2blink__array_8c.html#a69b7b102ebcf421b7170ebe2926126e4">leds</a></div><div class="ttdeci">ws2812_rgb leds[N_LEDS]</div><div class="ttdoc">RGB array which represents the LEDs.</div><div class="ttdef"><b>Definition:</b> <a href="arduino__avr_2blink__array_8c_source.html#l00055">blink_array.c:55</a></div></div>
<div class="ttc" id="aws2812__avr_8c_html_ae286d1f394d345649b3ad08404fcfed5"><div class="ttname"><a href="ws2812__avr_8c.html#ae286d1f394d345649b3ad08404fcfed5">ws2812_tx_byte</a></div><div class="ttdeci">void ws2812_tx_byte(ws2812 *dev, uint8_t byte)</div><div class="ttdoc">Transmits a byte of data to the WS2812 device.</div><div class="ttdef"><b>Definition:</b> <a href="ws2812__avr_8c_source.html#l00192">ws2812_avr.c:192</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2eb0bca405f4e5cffbed88230fd35038"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2eb0bca405f4e5cffbed88230fd35038">&#9670;&nbsp;</a></span>ws2812_wait_rst()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ws2812_wait_rst </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structws2812.html">ws2812</a> *&#160;</td>
          <td class="paramname"><em>dev</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Waits for the <a class="el" href="structws2812.html">WS2812 device</a> to reset. </p>
<p>The following function waits for the <a class="el" href="structws2812.html">WS2812 device</a> to reset, thus allowing it to be overwritten from the first LED again. The reset time is configuredin the <a class="el" href="structws2812__cfg.html" title="ALL PLATFORMS: Data structure to configure a WS2812 device struct.">ws2812_cfg</a> object used to initialize/configure the passed <a class="el" href="structws2812.html">WS2812 device struct</a>, and is recommended to be 50us according to the WS2812 datasheet, but may be set significantly lower for some WS2812 devices. Call this function if you wish to overwritte the WS2812 device after a previous <a class="el" href="ws2812_8h.html#af2db6a7db2e9f0a57921b01037202e15" title="Transmits RGB values to the provided WS2812 device.">ws2812_tx()</a> call.</p>
<dl class="section note"><dt>Note</dt><dd>This function does not have to be called prior calling #ws2812_end_tx() as it already contains a call to <a class="el" href="ws2812_8h.html#a2eb0bca405f4e5cffbed88230fd35038" title="Waits for the WS2812 device to reset.">ws2812_wait_rst()</a>. </dd></dl>

<p class="definition">Definition at line <a class="el" href="ws2812__stm8s_8c_source.html#l00119">119</a> of file <a class="el" href="ws2812__stm8s_8c_source.html">ws2812_stm8s.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;{</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structws2812.html#aac098f9c6f0f802c066122e0166d6970">rst_time_us</a>)</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        <a class="code" href="ws2812__avr_8c.html#a8069aef456aba6f66b80ac92a4746a32">delay_us</a>(dev-&gt;<a class="code" href="structws2812.html#aac098f9c6f0f802c066122e0166d6970">rst_time_us</a>);</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;}</div>
<div class="ttc" id="aws2812__avr_8c_html_a8069aef456aba6f66b80ac92a4746a32"><div class="ttname"><a href="ws2812__avr_8c.html#a8069aef456aba6f66b80ac92a4746a32">delay_us</a></div><div class="ttdeci">void delay_us(uint8_t us)</div><div class="ttdoc">Halts the program for a given ammount of microseconds.</div><div class="ttdef"><b>Definition:</b> <a href="ws2812__avr_8c_source.html#l00116">ws2812_avr.c:116</a></div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
