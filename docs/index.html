<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Tiny-WS2812: Tiny-WS2812 Library Documentation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Tiny-WS2812
   &#160;<span id="projectnumber">1.0.0</span>
   </div>
   <div id="projectbrief">A tiny cross-platform WS2812 LED Strip driver</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Tiny-WS2812 Library Documentation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#intro_sec">Introduction</a></li>
<li class="level1"><a href="#overview_sec">Overview</a></li>
<li class="level1"><a href="#basic_usage">Basic usage/tutorial</a><ul><li class="level2"><a href="#import_sec">Importing the library</a></li>
<li class="level2"><a href="#target_platform_sec">Selecting the target platform</a></li>
<li class="level2"><a href="#avr_example_sec">Learning by example: Blinking one or more WS2812 devices</a></li>
<li class="level2"><a href="#final_word">A final word</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p>Welcome to the Tiny-WS2812 documentation.</p>
<h1><a class="anchor" id="intro_sec"></a>
Introduction</h1>
<p>The Tiny-WS2812 library initially derived from the driver code of an open source WS2812 LED controller that I had worked on prior, and provides a nearly barebone interface to communicate with WS2812 devices.</p>
<p>The following platforms and frameworks are currently supported:</p><ul>
<li>Barebone AVR</li>
<li>The Arduino Framework (Currently only AVR based (eg. Uno, Leonardo, Micro...))</li>
<li>STM8S (With SPL)</li>
</ul>
<p>It has been developed out of the necessity to have an extremely light weight and flexible cross-platform library that can be further abstracted and used troughout my WS2812 projects, particullary on MCUs with severe memory constraints (ex. ATTiny and STM8S chips), where one cannot just define an RGB array equivalent to the number of LEDs. This libraries purpose is <b>NOT</b> to provide fancy abstractions and functions for color correction, brightness settings, animations etc.</p>
<p>To summerize, this library is inteded to:</p><ul>
<li>be used on MCUs with limited computing resources.</li>
<li>act as a base for more abstract WS2812 libraries.</li>
<li>be easily portable to other platforms or programming frameworks (ex. Arduino, STM8S).</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>Because the motivation of this library is to be as barebone as possible, it relies on a superficial understanding of the WS2812 protocol and may demand a more technical and in-depth understanding of the host platforms platform (eg. registers etc.). For quick and simple programming of WS2812 devices, where memory and processing power are not a big issue, other libraries should probably be consulted instead.</dd></dl>
<p>It is perhaps also noteworthy to mention that this library provides a pretty decent base to implement more abstract WS2812 libraries for the STM8S platform, which is fairly sparse in terms of available libraries. Futher, it has come to my notice that the few WS2812 libraries that are available for the STM8S at the time of writing often lack documentation.</p>
<h1><a class="anchor" id="overview_sec"></a>
Overview</h1>
<p>The WS2812 library code is split into two parts. The first part is the abstract library interface defined in <a class="el" href="ws2812_8h.html" title="Exposes the Tiny-WS2812 library interface.">ws2812.h</a>. The second part is the platform specific driver code that implements the interface for different platforms. The platform specific library implementations can be found in the <a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a> directory. To use this library throughout your project, only an understanding of the library interface is required.</p>
<p>For C++ projects, the WS2812 library also offers a WS2812 C++ wrapper class. For an usage example of the C++ wrapper, refer to the <a class="el" href="arduino__avr_2blink__cpp_8cpp.html">blink_cpp example for the Arduino Framework</a> or the <a class="el" href="avr_2blink__cpp_8cpp.html">blink_cpp example for barebone AVR programming</a></p>
<dl class="section note"><dt>Note</dt><dd>Due to the fact that STM8S target was written with SDCC in mind, the C++ wrapper is not available for the STM8S platform.</dd></dl>
<p>To make the use of this library a breeze, all source files have been documented and referenced using doxygen.</p>
<ul>
<li>You can find a list of classes here: <a href="annotated.html">Class list</a></li>
<li>You can find a overview of all source files, including examples, here: <a href="files.html">File list</a></li>
</ul>
<p>In the next section we will go through a basic example to get familiar with the library in no time.</p>
<h1><a class="anchor" id="basic_usage"></a>
Basic usage/tutorial</h1>
<h2><a class="anchor" id="import_sec"></a>
Importing the library</h2>
<p>The library has been primarily written with platformio in mind, but can be also be imported into the Arduino IDE and frankly, any other programming environment.</p>
<p>To import the library on platformio, simply look for its name in the extensions browser and download the extension.</p>
<p>Importing the library into the Arduino IDE is a little nasty, due to its limitations of now allowing one to define compile macros, as well as its incompatibility with c files. To still be able to import this project into the Arduino IDE, I have written a bash script to generate an Arduino-IDE compatible library, called makearduinolib.sh, which can be found in the tools/ folder of this project. To run it, simply execute:</p>
<div class="fragment"><div class="line">./tools/makearduinolib.sh</div>
</div><!-- fragment --><p>The script will ask you to specify a target platform and produce a Arduio-IDE compatible library zip in the root folder of this project.</p>
<h2><a class="anchor" id="target_platform_sec"></a>
Selecting the target platform</h2>
<dl class="section note"><dt>Note</dt><dd>This section can be skipped if you use the Arduino IDE and have generated a library zip using the script mentioned above, as a target platform has already been selected in the library generating process.</dd></dl>
<p>To use the Tiny-WS2812 library throughout your project, first ensure that you have specified the target platform for which the library is being build for. To do so, define one of the following build flags in your project:</p>
<ul>
<li>Barebone AVR: <code>WS2812_TARGET_PLATFORM_AVR</code></li>
<li>Arduino Framework (AVR): <code>WS2812_TARGET_PLATFORM_ARDUINO_AVR</code></li>
<li>STM8S: <code>WS2812_TARGET_PLATFORM_STM8S</code></li>
</ul>
<p>Support for more platforms (ex. ESP and ARM) is planned in the future.</p>
<p>Perhaps you may be wondering what the difference it makes to build for the barebone AVR target and the Arduino AVR target. While both targets can be effectively used for any AVR MCU based device, the barebone AVR target limits itself to the code provided by the AVR C libraries. The Arduino AVR target makes use of the code provided by the Arduino framework. The only difference relevant to the library user here is that the Arduino framework target will include the Arduino framework (which may not be desired or possible in some circumstances) and the differences in the library configuration struct (<a class="el" href="structws2812__cfg.html" title="Data structure to configure a WS2812 device struct on AVR platforms.">ws2812_cfg</a>, more on that later), which is platform specific and is used to configure various library parameters (data output pin, reset time, color order etc.).</p>
<p>As for STM8S builds: The STM8S target currently requires the Standard Peripheral Library (SPL) to be included. In the future, there will likely be a version of the library that does not require the SPL.</p>
<h2><a class="anchor" id="avr_example_sec"></a>
Learning by example: Blinking one or more WS2812 devices</h2>
<p>In the following section we will working our way through the <a class="el" href="arduino__avr_2blink__array_8c.html" title="Blinks one or more WS2812 devices using a RGB array.">examples/arduino_avr/blink_array.c</a> example. We assume our target platform to be ARDUINO_AVR, however most of the library specific code is the same across all platforms. Platform specific differences will be indicated.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;Arduino.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="ws2812_8h.html">ws2812.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Parameters - ALTER THESE TO CORRESPOND WITH YOUR OWN SETUP!</span></div>
<div class="line"><span class="preprocessor">#define N_LEDS 8         </span></div>
<div class="line"><span class="preprocessor">#define DATA_PINS {8, 9} </span></div>
<div class="line"><span class="preprocessor">#define RESET_TIME 50    </span></div>
<div class="line"><span class="preprocessor">#define COLOR_ORDER grb  </span></div>
<div class="line"><span class="preprocessor"></span> </div>
<div class="line">uint8_t <a class="code" href="arduino__avr_2blink__array_8c.html#a8bb65f860d3ee6bbb0dfe302cb9605da">pins</a>[] = <a class="code" href="arduino__avr_2blink__array_8c.html#ab2f896688f5d7b8efa2b810b4640503d">DATA_PINS</a>; </div>
<div class="line"><a class="code" href="structws2812__rgb.html">ws2812_rgb</a> <a class="code" href="arduino__avr_2blink__array_8c.html#a69b7b102ebcf421b7170ebe2926126e4">leds</a>[<a class="code" href="arduino__avr_2blink__array_8c.html#ae141ceb34938aab59b3009736e72a427">N_LEDS</a>];    </div>
<div class="line"><a class="code" href="structws2812.html">ws2812</a> <a class="code" href="arduino__avr_2blink__array_8c.html#aca30dc2f700892aa06cb62eae45d516e">ws2812_dev</a>;          </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="arduino__avr_2blink__array_8c.html#a4fc01d736fe50cf5b977f755b675f11d">setup</a>()</div>
<div class="line">{</div>
<div class="line">        <a class="code" href="structws2812__cfg.html">ws2812_cfg</a> cfg; <span class="comment">// Device config</span></div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Configure the WS2812 device struct</span></div>
<div class="line">        cfg.<a class="code" href="structws2812__cfg.html#ae4f693b8495942acae05da3df3bcfa58">pins</a> = <a class="code" href="arduino__avr_2blink__array_8c.html#a8bb65f860d3ee6bbb0dfe302cb9605da">pins</a>;</div>
<div class="line">        cfg.<a class="code" href="structws2812__cfg.html#a9131a1de83995aa8c917e1a3c6ee1fa5">rst_time_us</a> = <a class="code" href="arduino__avr_2blink__array_8c.html#abc83f110373bf0ab264aa8ffe232ee20">RESET_TIME</a>;</div>
<div class="line">        cfg.<a class="code" href="structws2812__cfg.html#ad50d0defcc33c93e648889222b93c1aa">order</a> = <a class="code" href="arduino__avr_2blink__array_8c.html#a00c9e5e8fdc981fc21a1e82e722980b2">COLOR_ORDER</a>;</div>
<div class="line">        cfg.<a class="code" href="structws2812__cfg.html#a2a6404a5d1e6d8829e2abcf5d916715b">n_dev</a> = <span class="keyword">sizeof</span>(<a class="code" href="arduino__avr_2blink__array_8c.html#a8bb65f860d3ee6bbb0dfe302cb9605da">pins</a>); <span class="comment">// Number of devices driven by this struct</span></div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="ws2812__avr_8c.html#a7b9cc89b40c838856b1fc741d5ab9a94">ws2812_config</a>(&amp;<a class="code" href="arduino__avr_2blink__array_8c.html#aca30dc2f700892aa06cb62eae45d516e">ws2812_dev</a>, &amp;cfg) != 0) {</div>
<div class="line">                <span class="comment">// HANDLE ERROR HERE</span></div>
<div class="line">                void;</div>
<div class="line">        }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="arduino__avr_2blink__array_8c.html#afe461d27b9c48d5921c00d521181f12f">loop</a>()</div>
<div class="line">{</div>
<div class="line">        <span class="comment">// Program all LEDs to white</span></div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="arduino__avr_2blink__array_8c.html#ae141ceb34938aab59b3009736e72a427">N_LEDS</a>; i++) {</div>
<div class="line">                <a class="code" href="arduino__avr_2blink__array_8c.html#a69b7b102ebcf421b7170ebe2926126e4">leds</a>[i].r = 255;</div>
<div class="line">                <a class="code" href="arduino__avr_2blink__array_8c.html#a69b7b102ebcf421b7170ebe2926126e4">leds</a>[i].g = 255;</div>
<div class="line">                <a class="code" href="arduino__avr_2blink__array_8c.html#a69b7b102ebcf421b7170ebe2926126e4">leds</a>[i].b = 255;              </div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="ws2812__avr_8c.html#a8ac53e8d64e1fc6073e85ea0fd80a975">ws2812_prep_tx</a>(&amp;<a class="code" href="arduino__avr_2blink__array_8c.html#aca30dc2f700892aa06cb62eae45d516e">ws2812_dev</a>);           <span class="comment">// Prepare to transmit data</span></div>
<div class="line">        <a class="code" href="ws2812__avr_8c.html#a910f8836ea93491a427642d1a6f631d4">ws2812_tx</a>(&amp;<a class="code" href="arduino__avr_2blink__array_8c.html#aca30dc2f700892aa06cb62eae45d516e">ws2812_dev</a>, <a class="code" href="arduino__avr_2blink__array_8c.html#a69b7b102ebcf421b7170ebe2926126e4">leds</a>, <a class="code" href="arduino__avr_2blink__array_8c.html#ae141ceb34938aab59b3009736e72a427">N_LEDS</a>);  <span class="comment">// Transmit array of rgb values to the device</span></div>
<div class="line">        <a class="code" href="ws2812__avr_8c.html#a0c2ce6b9d36f5c768bfdd781812aea34">ws2812_close_tx</a>(&amp;<a class="code" href="arduino__avr_2blink__array_8c.html#aca30dc2f700892aa06cb62eae45d516e">ws2812_dev</a>);          <span class="comment">// Close transmission</span></div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Wait 500ms</span></div>
<div class="line">        delay(500);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Program all LEDs to black (off)</span></div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="arduino__avr_2blink__array_8c.html#ae141ceb34938aab59b3009736e72a427">N_LEDS</a>; i++) {</div>
<div class="line">                <a class="code" href="arduino__avr_2blink__array_8c.html#a69b7b102ebcf421b7170ebe2926126e4">leds</a>[i].r = 0;</div>
<div class="line">                <a class="code" href="arduino__avr_2blink__array_8c.html#a69b7b102ebcf421b7170ebe2926126e4">leds</a>[i].g = 0;</div>
<div class="line">                <a class="code" href="arduino__avr_2blink__array_8c.html#a69b7b102ebcf421b7170ebe2926126e4">leds</a>[i].b = 0;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="ws2812__avr_8c.html#a8ac53e8d64e1fc6073e85ea0fd80a975">ws2812_prep_tx</a>(&amp;<a class="code" href="arduino__avr_2blink__array_8c.html#aca30dc2f700892aa06cb62eae45d516e">ws2812_dev</a>);          <span class="comment">// Prepare to transmit data</span></div>
<div class="line">        <a class="code" href="ws2812__avr_8c.html#a910f8836ea93491a427642d1a6f631d4">ws2812_tx</a>(&amp;<a class="code" href="arduino__avr_2blink__array_8c.html#aca30dc2f700892aa06cb62eae45d516e">ws2812_dev</a>, <a class="code" href="arduino__avr_2blink__array_8c.html#a69b7b102ebcf421b7170ebe2926126e4">leds</a>, <a class="code" href="arduino__avr_2blink__array_8c.html#ae141ceb34938aab59b3009736e72a427">N_LEDS</a>); <span class="comment">// Transmit array of rgb values to the device</span></div>
<div class="line">        <a class="code" href="ws2812__avr_8c.html#a0c2ce6b9d36f5c768bfdd781812aea34">ws2812_close_tx</a>(&amp;<a class="code" href="arduino__avr_2blink__array_8c.html#aca30dc2f700892aa06cb62eae45d516e">ws2812_dev</a>);         <span class="comment">// Close transmission</span></div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Wait 500ms</span></div>
<div class="line">        delay(500);</div>
<div class="line">}</div>
</div><!-- fragment --><p>Let's begin with the most obvious parts first. At the top of the code we import the <a class="el" href="ws2812_8h.html" title="Exposes the Tiny-WS2812 library interface.">ws2812.h</a> header. </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="ws2812_8h.html">ws2812.h</a>&gt;</span></div>
</div><!-- fragment --><p>This header exposes the interface of the WS2812 library, in other words, it provides you with all of the relevant functions to drive WS2812 devices.</p>
<p>Following the header inclusion, we define some fixed macro parameters that you must adjust to your own setup. </p><div class="fragment"><div class="line"><span class="preprocessor">#define N_LEDS 8         </span></div>
<div class="line"><span class="preprocessor">#define DATA_PINS {8, 9} </span></div>
<div class="line"><span class="preprocessor">#define RESET_TIME 50    </span></div>
<div class="line"><span class="preprocessor">#define COLOR_ORDER grb  ///&lt; Color order of your WS2812 LEDs (Typically grb or rgb</span></div>
</div><!-- fragment --><p>The <code>DATA_PINS</code> parameter tells the library which Arduino pins are used to program WS2812 devices. As you may have noticed by now, the library has the option to drive multiple WS2812 devices in parallel. However, this feature may be <b>platform specific</b> and comes with some restrictions.</p>
<dl class="section note"><dt>Note</dt><dd>A note on driving multiple WS2812 devices on AVR devices: Because GPIO pins are accessed via 8 bit port registers on AVR devices (each bit representing one GPIO), we have the possibility to output the same data across a maximum of 8 pins at the same time. This, however, is not without restrictions, as all data pins must be assigned to the same port register (see the <a href="https://www.arduino.cc/en/Reference/PortManipulation">Arduino Port Manipulation reference</a> for Arduino builds, or consult your AVR MCUs datasheet for barebone AVR builds). Further, since all pins will output the same data simultaneously, it also means that the WS2812 devices <b>must share color order and same number of LEDs</b>. For configurations where these requirements cannot be satisfied, it is recommended to create multiple <a class="el" href="structws2812.html">WS2812 device instances</a>, which can then be programmed in series. Noticeable delays for devices with a large number of LEDs can be reduced by quickly alternating transmission between them, as long as the MCU can toggle between transmissions faster than the reset time.</dd></dl>
<p>The <code>RESET_TIME</code> parameter tells the library how many microseconds it must wait after programming the WS2812 devices before it can program them from the first LED again. Should none of this make sense, it is highly advised to take a look at <a href="https://www.arrow.com/en/research-and-events/articles/protocol-for-the-ws2812b-programmable-led">how WS2812 devices are driven</a>.</p>
<p>The <code>COLOR_ORDER</code> parameters defines the color order in which the WS2812 LEDs must be written to. Unfortunately there is no fixed standard on the color order of WS2812 LEDs. Some are programmed in RGB order, however, from my own experience, GRB seems to be the most common order.</p>
<p>The remaining parameters, along with their comments, should be rather self explanatory.</p>
<p>Next up we have the following three defintions: </p><div class="fragment"><div class="line">uint8_t <a class="code" href="arduino__avr_2blink__array_8c.html#a8bb65f860d3ee6bbb0dfe302cb9605da">pins</a>[] = <a class="code" href="arduino__avr_2blink__array_8c.html#ab2f896688f5d7b8efa2b810b4640503d">DATA_PINS</a>; </div>
<div class="line"><a class="code" href="structws2812__rgb.html">ws2812_rgb</a> <a class="code" href="arduino__avr_2blink__array_8c.html#a69b7b102ebcf421b7170ebe2926126e4">leds</a>[<a class="code" href="arduino__avr_2blink__array_8c.html#ae141ceb34938aab59b3009736e72a427">N_LEDS</a>];    </div>
<div class="line"><a class="code" href="structws2812.html">ws2812</a> <a class="code" href="arduino__avr_2blink__array_8c.html#aca30dc2f700892aa06cb62eae45d516e">ws2812_dev</a>;          <span class="comment">///&lt; Device struct</span></div>
</div><!-- fragment --><p>In the top definition we create an array that will tell the library which pins are used to drive WS2812 devices.</p>
<p>In the middle definition we create an array of RGB values equal to the number of LEDs. This RGB array will be used to program the WS2812 devices and act as virtual representation of the LEDs on the device(s).</p>
<p>The latter definition creates a <a class="el" href="structws2812.html">WS2812 device struct</a> instance which is used to drive one or more assigned WS2812 devices.</p>
<p>Continuing further down we define the setup function: </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="arduino__avr_2blink__array_8c.html#a4fc01d736fe50cf5b977f755b675f11d">setup</a>()</div>
<div class="line">{</div>
<div class="line">        <a class="code" href="structws2812__cfg.html">ws2812_cfg</a> cfg; <span class="comment">// Device config</span></div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Configure the WS2812 device struct</span></div>
<div class="line">        cfg.<a class="code" href="structws2812__cfg.html#ae4f693b8495942acae05da3df3bcfa58">pins</a> = <a class="code" href="arduino__avr_2blink__array_8c.html#a8bb65f860d3ee6bbb0dfe302cb9605da">pins</a>;</div>
<div class="line">        cfg.<a class="code" href="structws2812__cfg.html#a9131a1de83995aa8c917e1a3c6ee1fa5">rst_time_us</a> = <a class="code" href="arduino__avr_2blink__array_8c.html#abc83f110373bf0ab264aa8ffe232ee20">RESET_TIME</a>;</div>
<div class="line">        cfg.<a class="code" href="structws2812__cfg.html#ad50d0defcc33c93e648889222b93c1aa">order</a> = <a class="code" href="arduino__avr_2blink__array_8c.html#a00c9e5e8fdc981fc21a1e82e722980b2">COLOR_ORDER</a>;</div>
<div class="line">        cfg.<a class="code" href="structws2812__cfg.html#a2a6404a5d1e6d8829e2abcf5d916715b">n_dev</a> = <span class="keyword">sizeof</span>(<a class="code" href="arduino__avr_2blink__array_8c.html#a8bb65f860d3ee6bbb0dfe302cb9605da">pins</a>); <span class="comment">// Number of devices driven by this struct</span></div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="ws2812__avr_8c.html#a7b9cc89b40c838856b1fc741d5ab9a94">ws2812_config</a>(&amp;<a class="code" href="arduino__avr_2blink__array_8c.html#aca30dc2f700892aa06cb62eae45d516e">ws2812_dev</a>, &amp;cfg) != 0) {</div>
<div class="line">                <span class="comment">// HANDLE ERROR HERE</span></div>
<div class="line">                void;</div>
<div class="line">        }</div>
<div class="line">}</div>
</div><!-- fragment --><p>Within the <a class="el" href="arduino__avr_2blink__array_8c.html#a4fc01d736fe50cf5b977f755b675f11d">setup()</a> function we set the fields, we create a <a class="el" href="structws2812__cfg.html">ws2812_cfg configuration struct</a> and use it to configure our <a class="el" href="structws2812.html">WS2812 device struct</a> instance using the <a class="el" href="ws2812__avr_8c.html#a7b9cc89b40c838856b1fc741d5ab9a94" title="Configures a WS2812 device struct.">ws2812_config()</a> function. The code should be rather self explanatory since it simply parses the parameter macros that we have already discussed above. </p><dl class="section note"><dt>Note</dt><dd>The <a class="el" href="structws2812__cfg.html" title="Data structure to configure a WS2812 device struct on AVR platforms.">ws2812_cfg</a> struct is <b>platform specific</b>! In this example we see how to configure the for the ARDUINO_AVR target platform, for other target platforms, please refer to the <a class="el" href="dir_d28a4824dc47e487b107a5db32ef43c4.html">platform specific examples</a> or the <a class="el" href="structws2812__cfg.html">ws2812_cfg reference page</a>. </dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>All fields of the configuration object must be defined. Leaving fields undefined will lead to undefined behaivor!</dd></dl>
<p>Next up we come to the <a class="el" href="arduino__avr_2blink__array_8c.html#afe461d27b9c48d5921c00d521181f12f">loop()</a> function, here we will make the device blink.</p>
<p>We start off by setting all RGB values in our LEDs array to white: </p><div class="fragment"><div class="line"><span class="comment">// Program all LEDs to white</span></div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="arduino__avr_2blink__array_8c.html#ae141ceb34938aab59b3009736e72a427">N_LEDS</a>; i++) {</div>
<div class="line">        <a class="code" href="arduino__avr_2blink__array_8c.html#a69b7b102ebcf421b7170ebe2926126e4">leds</a>[i].r = 255;</div>
<div class="line">        <a class="code" href="arduino__avr_2blink__array_8c.html#a69b7b102ebcf421b7170ebe2926126e4">leds</a>[i].g = 255;</div>
<div class="line">        <a class="code" href="arduino__avr_2blink__array_8c.html#a69b7b102ebcf421b7170ebe2926126e4">leds</a>[i].b = 255;              </div>
<div class="line">}</div>
</div><!-- fragment --><p>Now that the LED array has been filled with white, all that is left is to transmit its values to the WS2812 device(s): </p><div class="fragment"><div class="line"><a class="code" href="ws2812__avr_8c.html#a8ac53e8d64e1fc6073e85ea0fd80a975">ws2812_prep_tx</a>(&amp;<a class="code" href="arduino__avr_2blink__array_8c.html#aca30dc2f700892aa06cb62eae45d516e">ws2812_dev</a>);           <span class="comment">// Prepare to transmit data</span></div>
<div class="line"><a class="code" href="ws2812__avr_8c.html#a910f8836ea93491a427642d1a6f631d4">ws2812_tx</a>(&amp;<a class="code" href="arduino__avr_2blink__array_8c.html#aca30dc2f700892aa06cb62eae45d516e">ws2812_dev</a>, <a class="code" href="arduino__avr_2blink__array_8c.html#a69b7b102ebcf421b7170ebe2926126e4">leds</a>, <a class="code" href="arduino__avr_2blink__array_8c.html#ae141ceb34938aab59b3009736e72a427">N_LEDS</a>);  <span class="comment">// Transmit array of rgb values to the device</span></div>
<div class="line"><a class="code" href="ws2812__avr_8c.html#a0c2ce6b9d36f5c768bfdd781812aea34">ws2812_close_tx</a>(&amp;<a class="code" href="arduino__avr_2blink__array_8c.html#aca30dc2f700892aa06cb62eae45d516e">ws2812_dev</a>);          <span class="comment">// Close transmission</span></div>
</div><!-- fragment --><p>First, we call <a class="el" href="ws2812__avr_8c.html#a8ac53e8d64e1fc6073e85ea0fd80a975" title="Prepares the host device for data transmission.">ws2812_prep_tx()</a> to prepare the host device and the device object for data tranmission. Following the <a class="el" href="ws2812__avr_8c.html#a8ac53e8d64e1fc6073e85ea0fd80a975" title="Prepares the host device for data transmission.">ws2812_prep_tx()</a> call we then transmit the rgb values of the RGB array to the WS2812 device(s). Finally, once we are done transmitting, we proceed to close the tranmission. The WS2812 device(s) should now be set to white.</p>
<dl class="section warning"><dt>Warning</dt><dd>Calling <a class="el" href="ws2812__avr_8c.html#a910f8836ea93491a427642d1a6f631d4" title="Transmits RGB values to the provided WS2812 device.">ws2812_tx()</a> consecutively without closing and preparing a new transmission, or without waiting for the WS2812 device(s) to reset by calling <a class="el" href="ws2812__avr_8c.html#a2eb0bca405f4e5cffbed88230fd35038" title="Waits for the WS2812 device to reset.">ws2812_wait_rst()</a>, will cause the device(s) to get programmed from position where the last transmission has ended. This can actually be used to to ones advantage, as seen in the <a class="el" href="arduino__avr_2blink__loop_8c.html">blink_loop</a> example, where we save memory by repeatedly tranmsitting the same RGB value to fill the device instead of creating an RGB array equal to the number of LEDs.</dd></dl>
<p>Given that we have made it this far, the rest of the code should require little explanation, as we simply wait for a total of 500ms, set our device(s) to off using the exact same procedure that we have used to set it white, and lastly wait another 500ms. After that, everything simply gets repeated again and we should be seeing one or more blinking WS2812 devices.</p>
<h2><a class="anchor" id="final_word"></a>
A final word</h2>
<p>In the example above we have used an RGB array to set the colors of one or more WS2812 devices. However, for cases like above, where we only wish to fill the entire device with a single color, allocating an RGB array equal to the number of LEDs seems like a memory expensive solution. Instead of allocating an array for all LEDs, we can simply repeatedly transmit the same color value to the WS2812 device(s) until all LEDs has been set. This much more memory friendly method is showcased in the <a class="el" href="arduino__avr_2blink__loop_8c.html">blink_loop</a> example. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<div class="ttc" id="aarduino__avr_2blink__array_8c_html_abc83f110373bf0ab264aa8ffe232ee20"><div class="ttname"><a href="arduino__avr_2blink__array_8c.html#abc83f110373bf0ab264aa8ffe232ee20">RESET_TIME</a></div><div class="ttdeci">#define RESET_TIME</div><div class="ttdoc">Reset time in microseconds (50us recommended by datasheet)</div><div class="ttdef"><b>Definition:</b> <a href="arduino__avr_2blink__array_8c_source.html#l00051">blink_array.c:51</a></div></div>
<div class="ttc" id="aws2812__avr_8c_html_a7b9cc89b40c838856b1fc741d5ab9a94"><div class="ttname"><a href="ws2812__avr_8c.html#a7b9cc89b40c838856b1fc741d5ab9a94">ws2812_config</a></div><div class="ttdeci">uint8_t ws2812_config(ws2812 *dev, ws2812_cfg *cfg)</div><div class="ttdoc">Configures a WS2812 device struct.</div><div class="ttdef"><b>Definition:</b> <a href="ws2812__avr_8c_source.html#l00126">ws2812_avr.c:126</a></div></div>
<div class="ttc" id="astructws2812__cfg_html_a9131a1de83995aa8c917e1a3c6ee1fa5"><div class="ttname"><a href="structws2812__cfg.html#a9131a1de83995aa8c917e1a3c6ee1fa5">ws2812_cfg::rst_time_us</a></div><div class="ttdeci">uint8_t rst_time_us</div><div class="ttdoc">Time required for WS2812 to reset in us.</div><div class="ttdef"><b>Definition:</b> <a href="ws2812__avr_8h_source.html#l00061">ws2812_avr.h:61</a></div></div>
<div class="ttc" id="astructws2812__cfg_html"><div class="ttname"><a href="structws2812__cfg.html">ws2812_cfg</a></div><div class="ttdoc">Data structure to configure a WS2812 device struct on AVR platforms.</div><div class="ttdef"><b>Definition:</b> <a href="ws2812__avr_8h_source.html#l00049">ws2812_avr.h:49</a></div></div>
<div class="ttc" id="aws2812_8h_html"><div class="ttname"><a href="ws2812_8h.html">ws2812.h</a></div><div class="ttdoc">Exposes the Tiny-WS2812 library interface.</div></div>
<div class="ttc" id="aws2812__avr_8c_html_a8ac53e8d64e1fc6073e85ea0fd80a975"><div class="ttname"><a href="ws2812__avr_8c.html#a8ac53e8d64e1fc6073e85ea0fd80a975">ws2812_prep_tx</a></div><div class="ttdeci">void ws2812_prep_tx(ws2812 *dev)</div><div class="ttdoc">Prepares the host device for data transmission.</div><div class="ttdef"><b>Definition:</b> <a href="ws2812__avr_8c_source.html#l00159">ws2812_avr.c:159</a></div></div>
<div class="ttc" id="astructws2812__rgb_html"><div class="ttname"><a href="structws2812__rgb.html">ws2812_rgb</a></div><div class="ttdoc">Data structure to hold RGB color values.</div><div class="ttdef"><b>Definition:</b> <a href="ws2812__common_8h_source.html#l00067">ws2812_common.h:67</a></div></div>
<div class="ttc" id="aarduino__avr_2blink__array_8c_html_a4fc01d736fe50cf5b977f755b675f11d"><div class="ttname"><a href="arduino__avr_2blink__array_8c.html#a4fc01d736fe50cf5b977f755b675f11d">setup</a></div><div class="ttdeci">void setup()</div><div class="ttdef"><b>Definition:</b> <a href="arduino__avr_2blink__array_8c_source.html#l00061">blink_array.c:61</a></div></div>
<div class="ttc" id="astructws2812__cfg_html_a2a6404a5d1e6d8829e2abcf5d916715b"><div class="ttname"><a href="structws2812__cfg.html#a2a6404a5d1e6d8829e2abcf5d916715b">ws2812_cfg::n_dev</a></div><div class="ttdeci">uint8_t n_dev</div><div class="ttdoc">Number of WS2812 devices driven.</div><div class="ttdef"><b>Definition:</b> <a href="ws2812__avr_8h_source.html#l00063">ws2812_avr.h:63</a></div></div>
<div class="ttc" id="astructws2812__cfg_html_ae4f693b8495942acae05da3df3bcfa58"><div class="ttname"><a href="structws2812__cfg.html#ae4f693b8495942acae05da3df3bcfa58">ws2812_cfg::pins</a></div><div class="ttdeci">uint8_t * pins</div><div class="ttdoc">Array of pins used to program WS2812 devices (Must share the same PORT! (ex. PB0, PB1,...</div><div class="ttdef"><b>Definition:</b> <a href="ws2812__avr_8h_source.html#l00054">ws2812_avr.h:54</a></div></div>
<div class="ttc" id="aarduino__avr_2blink__array_8c_html_ab2f896688f5d7b8efa2b810b4640503d"><div class="ttname"><a href="arduino__avr_2blink__array_8c.html#ab2f896688f5d7b8efa2b810b4640503d">DATA_PINS</a></div><div class="ttdeci">#define DATA_PINS</div><div class="ttdoc">Arduino pin(s) used to program the WS2812 device(s). Must share same port! (See https://www....</div><div class="ttdef"><b>Definition:</b> <a href="arduino__avr_2blink__array_8c_source.html#l00050">blink_array.c:50</a></div></div>
<div class="ttc" id="aarduino__avr_2blink__array_8c_html_ae141ceb34938aab59b3009736e72a427"><div class="ttname"><a href="arduino__avr_2blink__array_8c.html#ae141ceb34938aab59b3009736e72a427">N_LEDS</a></div><div class="ttdeci">#define N_LEDS</div><div class="ttdoc">Number of LEDs on your WS2812 device(s)</div><div class="ttdef"><b>Definition:</b> <a href="arduino__avr_2blink__array_8c_source.html#l00049">blink_array.c:49</a></div></div>
<div class="ttc" id="astructws2812__cfg_html_ad50d0defcc33c93e648889222b93c1aa"><div class="ttname"><a href="structws2812__cfg.html#ad50d0defcc33c93e648889222b93c1aa">ws2812_cfg::order</a></div><div class="ttdeci">ws2812_order order</div><div class="ttdoc">Color order (ex. rgb, grb, bgr...)</div><div class="ttdef"><b>Definition:</b> <a href="ws2812__avr_8h_source.html#l00062">ws2812_avr.h:62</a></div></div>
<div class="ttc" id="aarduino__avr_2blink__array_8c_html_aca30dc2f700892aa06cb62eae45d516e"><div class="ttname"><a href="arduino__avr_2blink__array_8c.html#aca30dc2f700892aa06cb62eae45d516e">ws2812_dev</a></div><div class="ttdeci">ws2812 ws2812_dev</div><div class="ttdoc">Device struct.</div><div class="ttdef"><b>Definition:</b> <a href="arduino__avr_2blink__array_8c_source.html#l00056">blink_array.c:56</a></div></div>
<div class="ttc" id="aarduino__avr_2blink__array_8c_html_afe461d27b9c48d5921c00d521181f12f"><div class="ttname"><a href="arduino__avr_2blink__array_8c.html#afe461d27b9c48d5921c00d521181f12f">loop</a></div><div class="ttdeci">void loop()</div><div class="ttdef"><b>Definition:</b> <a href="arduino__avr_2blink__array_8c_source.html#l00080">blink_array.c:80</a></div></div>
<div class="ttc" id="aarduino__avr_2blink__array_8c_html_a8bb65f860d3ee6bbb0dfe302cb9605da"><div class="ttname"><a href="arduino__avr_2blink__array_8c.html#a8bb65f860d3ee6bbb0dfe302cb9605da">pins</a></div><div class="ttdeci">uint8_t pins[]</div><div class="ttdoc">Data pins.</div><div class="ttdef"><b>Definition:</b> <a href="arduino__avr_2blink__array_8c_source.html#l00054">blink_array.c:54</a></div></div>
<div class="ttc" id="aws2812__avr_8c_html_a0c2ce6b9d36f5c768bfdd781812aea34"><div class="ttname"><a href="ws2812__avr_8c.html#a0c2ce6b9d36f5c768bfdd781812aea34">ws2812_close_tx</a></div><div class="ttdeci">void ws2812_close_tx(ws2812 *dev)</div><div class="ttdoc">Closes a WS2812 transmission.</div><div class="ttdef"><b>Definition:</b> <a href="ws2812__avr_8c_source.html#l00275">ws2812_avr.c:275</a></div></div>
<div class="ttc" id="aws2812__avr_8c_html_a910f8836ea93491a427642d1a6f631d4"><div class="ttname"><a href="ws2812__avr_8c.html#a910f8836ea93491a427642d1a6f631d4">ws2812_tx</a></div><div class="ttdeci">void ws2812_tx(ws2812 *dev, ws2812_rgb *leds, size_t n_leds)</div><div class="ttdoc">Transmits RGB values to the provided WS2812 device.</div><div class="ttdef"><b>Definition:</b> <a href="ws2812__avr_8c_source.html#l00264">ws2812_avr.c:264</a></div></div>
<div class="ttc" id="astructws2812_html"><div class="ttname"><a href="structws2812.html">ws2812</a></div><div class="ttdoc">WS2812 device struct to drive one or more WS2812 devices on AVR based platforms.</div><div class="ttdef"><b>Definition:</b> <a href="ws2812__avr_8h_source.html#l00078">ws2812_avr.h:78</a></div></div>
<div class="ttc" id="aarduino__avr_2blink__array_8c_html_a69b7b102ebcf421b7170ebe2926126e4"><div class="ttname"><a href="arduino__avr_2blink__array_8c.html#a69b7b102ebcf421b7170ebe2926126e4">leds</a></div><div class="ttdeci">ws2812_rgb leds[N_LEDS]</div><div class="ttdoc">RGB array which represents the LEDs.</div><div class="ttdef"><b>Definition:</b> <a href="arduino__avr_2blink__array_8c_source.html#l00055">blink_array.c:55</a></div></div>
<div class="ttc" id="aarduino__avr_2blink__array_8c_html_a00c9e5e8fdc981fc21a1e82e722980b2"><div class="ttname"><a href="arduino__avr_2blink__array_8c.html#a00c9e5e8fdc981fc21a1e82e722980b2">COLOR_ORDER</a></div><div class="ttdeci">#define COLOR_ORDER</div><div class="ttdoc">Color order of your WS2812 LEDs (Typically grb or rgb)</div><div class="ttdef"><b>Definition:</b> <a href="arduino__avr_2blink__array_8c_source.html#l00052">blink_array.c:52</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
